<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <style>
    @page {
  size: A4 landscape;
  margin: 16mm 14mm;
}
body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  color: #222;
  font-size: 12px;
  line-height: 1.45;
}
.header {
  margin-bottom: 12px;
}
h1 {
  font-size: 18px;
  margin: 0 0 6px 0;
}
h2 {
  font-size: 16px;
  margin: 20px 0 8px 0;
  page-break-after: avoid;
}
.sheet {
  break-inside: avoid;
  margin-bottom: 12px;
}
.table-wrap {
  overflow: auto;
  border: 1px solid #eaeaea;
  border-radius: 8px;
}
table {
  border-collapse: collapse;
  width: 100%;
}
th,
td {
  border: 1px solid #ddd;
  padding: 6px 8px;
  vertical-align: top;
}
th {
  background: #f7f7f7;
  font-weight: 600;
}
.caption {
  color: #666;
  font-size: 11px;
  margin-bottom: 6px;
}
.footer {
  margin-top: 16px;
  color: #777;
  font-size: 11px;
}

.grid.grid-2 {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 16px;
}

.card-title {
  font-weight: 700;
  margin-bottom: 12px;
  color: #fff;
  padding: 8px 12px;
  border-radius: 10px;
  background: linear-gradient(135deg, #ff6a6a, #ffa46a);
}
.legend {
  margin-top: 8px;
  font-size: 12px;
  color: #666;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
}
.dot {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 6px;
  background: #999;
}
.dot-total {
  background: #00e6b8;
}
.dot-ans {
  background: #f7b733;
}
.dot-ivr {
  background: #ff6b81;
}
.dot-line {
  background: #3b82f6;
  border-radius: 2px;
  width: 18px;
  height: 3px;
  align-self: center;
}
table.cmp {
  width: 100%;
  border-collapse: collapse;
}
table.cmp th,
table.cmp td {
  border: 1px solid #e5e5e5;
  padding: 8px;
}
table.cmp thead th {
  background: #ffe9e1;
}
td.up {
  color: #0a8f3c;
  font-weight: 600;
}
td.down {
  color: #d14242;
  font-weight: 600;
}

/* Section header */
.kpi-note {
  margin: 8px 2px 2px;
  color: #444;
}
.kpi-note .up {
  color: #0a8f3c;
  font-weight: 600;
}
.kpi-note .down {
  color: #d14242;
  font-weight: 600;
}

/* Cards container */
.channel-cards .card {
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 12px;
}
.mini-grid {
  display: grid;
  grid-template-columns: repeat(6, minmax(140px, 1fr));
  gap: 16px;
}
.mini-card {
  border-radius: 12px;
  padding: 16px;
  background: var(--grad);
  color: #fff;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
}
.mini-title {
  display: inline-block;
  color: #eef;
  text-decoration: underline;
  margin-bottom: 6px;
}
.mini-value {
  font-size: 22px;
  font-weight: 800;
  line-height: 1.2;
}
.mini-sub {
  font-size: 12px;
  opacity: 0.95;
  margin-top: 2px;
}
.mini-delta {
  margin-top: 6px;
  font-weight: 700;
}
.mini-delta.up {
  color: #c8ffd1;
}
.mini-delta.down {
  color: #ffd1d1;
}

/* Хэвлэхэд мөр таслахгүй байхаар */
.channel-cards .mini-grid {
  break-inside: avoid;
}

.ost .card {
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 16px;
} /* grid/картууд аль хэдийн байвал давхардахгүй */

.fb-wrap {
  margin-top: 18px;
  border-radius: 8px;
  overflow: hidden;
}
.fb-head {
  margin: 0;
  padding: 8px 12px;
  background: #1e40af;
  color: #fff;
}
.fb-company {
  padding: 10px 12px;
  border: 1px solid #e5e5e5;
  border-top: none;
}
.fb-company .fb-title {
  font-weight: 700;
  margin-bottom: 6px;
}
.fb-company ul {
  margin: 0;
  padding-left: 18px;
}
.fb-company li {
  margin: 2px 0;
}
.fb-company .count {
  color: #666;
  font-size: 12px;
}

.ost-top .card {
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 16px;
}

.card.soft {
  padding: 12px;
}
.chart-wrap {
  break-inside: avoid;
}
.cmp {
  width: 100%;
  border-collapse: collapse;
}
.cmp th,
.cmp td {
  border: 1px solid #e5e5e5;
  padding: 8px;
  vertical-align: top;
}
.cmp thead th {
  background: #ffe9e1;
}
.cmp .num {
  text-align: right;
}
.up {
  color: #0a8f3c;
  font-weight: 600;
}
.down {
  color: #d14242;
  font-weight: 600;
}

.social .card-title {
  background: linear-gradient(135deg, #ff6a6a, #ffa46a);
  color: #fff;
}

.spacer16 {
  height: 16px;
}

    /* A4 landscape дотор багтах дээд өргөн */
    .container { max-width: 1080px; margin: 0 auto; }
    .card { padding: 16px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.05); }
    .card-title { font-weight: 700; margin-bottom: 8px; }
    .cmp { width: 100%; border-collapse: collapse; }
    .cmp th, .cmp td { padding: 8px 10px; border-bottom: 1px solid #eee; }
    .cmp .num { text-align: right; }
    .cmp .up{color:#16a34a}.cmp .down{color:#ef4444}
    /* тогтвортой өндөртэй canvas — responsive үед ч хоосон болохгүй */
/* ... бусад стил ... */
#arbLine  { width:100% !important; height:320px !important; } /* өмнөхөөс бага */
#arbWeeks { width:100% !important; height:260px !important; } /* ↓ багасгалаа */
/* ... */

    @media print { .card { break-inside: avoid; page-break-inside: avoid; } }
  </style>

  <!-- Глобал плагин: тоонуудыг давхцахгүй байршуулна -->
  <script>
    window.dataLabelPlus = {
      id: 'dataLabelPlus',
      afterDatasetsDraw(chart){
        const {ctx, data, scales, config} = chart;
        const yScale = scales?.y, labels = data?.labels||[], sets = data?.datasets||[];
        ctx.save();
        ctx.font='bold 12px system-ui,-apple-system,Segoe UI,Roboto,Arial';
        ctx.textAlign='center'; ctx.lineWidth=3;
        ctx.strokeStyle='rgba(255,255,255,.96)'; ctx.fillStyle='#111';
        const isBar = config.type==='bar';
        const isStacked = !!(chart.options?.scales?.x?.stacked && chart.options?.scales?.y?.stacked);

        // dataset labels
        sets.forEach((ds,di)=>{
          const meta=chart.getDatasetMeta(di);
          (ds.data||[]).forEach((v,i)=>{
            if(v==null) return;
            const el = meta.data?.[i]; if(!el) return;
            if(isBar){ const h=Math.abs((el.base??el.y)-el.y); if(h<18) return; }
            const pos = el.tooltipPosition?el.tooltipPosition():el;
            const x=pos.x, y=isBar? (el.y+(el.base??el.y))/2 : (pos.y-6);
            const t = Number(v).toLocaleString('mn-MN');
            ctx.strokeText(t,x,y); ctx.fillText(t,x,y);
          });
        });

        // totals (stacked bar)
        if(isBar && isStacked && yScale && typeof yScale.getPixelForValue==='function'){
          const totals = labels.map((_,i)=>sets.reduce((s,ds)=>s+(+ds.data?.[i]||0),0));
          const metas = sets.map((_,di)=>chart.getDatasetMeta(di));
          totals.forEach((tot,i)=>{
            const base = metas[0]?.data?.[i]; if(!base) return;
            const x=(base.tooltipPosition?base.tooltipPosition():base).x;
            const yTop=yScale.getPixelForValue(tot);
            let minY=Infinity;
            metas.forEach(m=>{
              const el=m.data?.[i]; if(!el) return;
              const h=Math.abs((el.base??el.y)-el.y);
              if(h>=18){ const yc=(el.y+(el.base??el.y))/2; minY=Math.min(minY,yc); }
            });
            let y=yTop-10; if(y>(minY-12)) y=minY-12;
            const t=Number(tot).toLocaleString('mn-MN');
            ctx.strokeText(t,x,y); ctx.fillText(t,x,y);
          });
        }
        ctx.restore();
      }
    };

    // PDF-д хэвлэхээс өмнө chart дууссаныг шалгах тоолуур
    window.__chartsReadyCount = 0;
    window._incReady = function(){ window.__chartsReadyCount++; if(window.__chartsReadyCount>=2) window.__chartsReady=true; };
  </script>
</head>
<body>
  <div class="container py-3">
    
  <section class="hero" style="margin-bottom:16px">
    <div style="background:linear-gradient(135deg,#ef4444,#f97316);border-radius:12px;padding:24px;display:flex;justify-content:space-between;align-items:center;min-height:160px;">
      <div style="background:#fff;border-radius:14px;padding:16px 20px;display:inline-block">
        <div style="font-weight:800;font-size:24px;letter-spacing:.5px;color:#ef4444">ARD</div>
        <div style="color:#666;margin-top:4px">Хүчтэй. Хамтдаа.</div>
      </div>
      <div style="color:#fff;text-align:right;padding:6px 12px">
        <div style="font-size:30px;font-weight:800;line-height:1.1">Ард Бит</div>
        <div style="opacity:.9;margin-top:6px">10.06-10.12 → 10.13-10.19</div>
      </div>
    </div>
  </section>
  <section>
    
    <div class="card" style="margin-bottom:12px">
      <div class="card-title">НИЙТ ХАНДАЛТ /Сүүлийн 4 сараар/</div>
      <canvas id="arbLine"></canvas>
    </div>
    <script>(function(){
      try{
        const ctx=document.getElementById('arbLine').getContext('2d');
        new Chart(ctx,{
          type:'line',
          data:{ labels:["7 сар (2025)","8 сар (2025)","9 сар (2025)","10 сар (2025)"],
                 datasets:[{label:'', data:[668,726,796,507], tension:.3, pointRadius:4 }] },
          options:{ animation:false, responsive:true, maintainAspectRatio:false,
                    plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} },
          plugins:[window.dataLabelPlus||{}]
        });
      }catch(e){ console.error('arbLine error', e); }
      _incReady();
    })();</script>
    
    <div class="card">
      <div class="card-title">НИЙТ БҮРТГЭЛ /Сүүлийн 2 долоо хоногоор/</div>
      <canvas id="arbWeeks"></canvas>
    </div>
    <script>(function(){
      try{
        const ctx=document.getElementById('arbWeeks').getContext('2d');
        new Chart(ctx,{
          type:'bar',
          data:{ labels:["10.06-10.12","10.13-10.19"], datasets:[
            {label:'Лавлагаа',  data:[175,161]},
            {label:'Үйлчилгээ', data:[2,3]},
            {label:'Гомдол',    data:[3,22]}
          ]},
          options:{ animation:false, responsive:true, maintainAspectRatio:false,
                    plugins:{legend:{position:'bottom'}},
                    scales:{ x:{stacked:true}, y:{stacked:true, beginAtZero:true} } },
          plugins:[window.dataLabelPlus||{}]
        });
      }catch(e){ console.error('arbWeeks error', e); }
      _incReady();
    })();</script>
    <div class="grid" style="margin-top:12px">
      
    <div class="card">
      <div class="card-title">ТОП Лавлагаа</div>
      <table class="cmp">
        <thead><tr><th></th><th>10.06-10.12</th><th>10.13-10.19</th><th>%</th></tr></thead>
        <tbody>
          
            <tr><td>АрдКойны үлдэгдэл шалгах</td>
                <td class="num">77</td>
                <td class="num">58</td>
                <td class="num down">▼ 25%</td></tr>
            <tr><td>АрдКойн ашиглах заавар</td>
                <td class="num">34</td>
                <td class="num">48</td>
                <td class="num up">▲ 41%</td></tr>
            <tr><td>RDX урамшуулал шалгах заавар</td>
                <td class="num">13</td>
                <td class="num">10</td>
                <td class="num down">▼ 23%</td></tr>
            <tr><td>Данс цуцлах заавар</td>
                <td class="num">9</td>
                <td class="num">8</td>
                <td class="num down">▼ 11%</td></tr>
            <tr><td>Урамшууллын АрдКойн орох заавар</td>
                <td class="num">7</td>
                <td class="num">8</td>
                <td class="num up">▲ 14%</td></tr>
            <tr><td>Ерөнхий мэдээлэл өгсөн</td>
                <td class="num">4</td>
                <td class="num">7</td>
                <td class="num up">▲ 75%</td></tr>
            <tr><td>Урамшууллын АрдКойны блок</td>
                <td class="num">9</td>
                <td class="num">6</td>
                <td class="num down">▼ 33%</td></tr>
            <tr><td>АрдКойн авах заавар</td>
                <td class="num">3</td>
                <td class="num">4</td>
                <td class="num up">▲ 33%</td></tr>
            <tr><td>Ард Апп хооронд АрдКойны шилжүүлэг хийх заавар</td>
                <td class="num">6</td>
                <td class="num">3</td>
                <td class="num down">▼ 50%</td></tr>
            <tr><td>АрдКойн шатаалт</td>
                <td class="num">5</td>
                <td class="num">3</td>
                <td class="num down">▼ 40%</td></tr>
        </tbody>
      </table>
    </div>
      
    <div class="card">
      <div class="card-title">ТОП Үйлчилгээ</div>
      <table class="cmp">
        <thead><tr><th></th><th>10.06-10.12</th><th>10.13-10.19</th><th>%</th></tr></thead>
        <tbody>
          
            <tr><td>HODL цуцлах заавар</td>
                <td class="num">2</td>
                <td class="num">3</td>
                <td class="num up">▲ 50%</td></tr>
        </tbody>
      </table>
    </div>
      
    <div class="card">
      <div class="card-title">ТОП Гомдол</div>
      <table class="cmp">
        <thead><tr><th></th><th>10.06-10.12</th><th>10.13-10.19</th><th>%</th></tr></thead>
        <tbody>
          
            <tr><td>Залилангийн шинжтэй үйлдэл</td>
                <td class="num">0</td>
                <td class="num">6</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>АрдКойны үлдэгдэл харагдахгүй</td>
                <td class="num">0</td>
                <td class="num">4</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>Данс цуцлагдаагүй</td>
                <td class="num">2</td>
                <td class="num">3</td>
                <td class="num up">▲ 50%</td></tr>
            <tr><td>Авдар апп-д шилжүүлсэн орлого ороогүй</td>
                <td class="num">0</td>
                <td class="num">3</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>RDX лимит шинэчлэгдээгүй</td>
                <td class="num">0</td>
                <td class="num">2</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>Дансанд байсан Койн шатаагдсан</td>
                <td class="num">0</td>
                <td class="num">2</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>Койны данснаас зарлага гарахгүй алдаа заасан</td>
                <td class="num">0</td>
                <td class="num">1</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>Урамшууллын АрдКойн ороогүй</td>
                <td class="num">0</td>
                <td class="num">1</td>
                <td class="num up">▲ 100%</td></tr>
            <tr><td>Форвард</td>
                <td class="num">1</td>
                <td class="num">0</td>
                <td class="num down">▼ 100%</td></tr>
        </tbody>
      </table>
    </div>
    </div>
  </section>
    <div class="footer" style="color:#888;font-size:12px;margin-top:8px">Автоматаар бэлтгэсэн тайлан (Ard Bit)</div>
  </div>
</body>
</html>